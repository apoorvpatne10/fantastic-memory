# fantastic-memory

Lip Reading using STCNNs and Bi-GRUs. Currently under development.

Project is based on [LipNet](https://github.com/apoorvpatne10/fantastic-memory/blob/master/lipNet.pdf).

Dataset used : [MIRACL-VC1](https://www.kaggle.com/apoorvwatsky/miraclvc1).

## Lip Extraction demo

Make sure that the video's framerate is 25fps.

```
apoorv@apoorv:~/Work$ python prepare_data_from_video.py -h
usage: prepare_data_from_video.py [-h] path

Add path to video

positional arguments:
  path        Mention the path to the video

optional arguments:
  -h, --help  show this help message and exit
  
Example : python prepare_data_from_video.py /home/Desktop/abc.mp4 

```

This will be followed by generation of a numpy sequence in ```frame_numpy_sequence``` directory. Passing this to our classification model will result in the label of the corresponding word being said in the video.

## TODOs

- [ ] Use C3D model
- [ ] Reduce overfitting
- [ ] Data augmentation
- [x] Dropout
- [x] For words
- [ ] For phrases
- [ ] Batch Normalization

## Model Summary (Temporary)

```
Layer (type)                 Output Shape              Param #   
=================================================================
conv3d_4 (Conv3D)            (None, 9, 43, 43, 8)      1736      
_________________________________________________________________
max_pooling3d_4 (MaxPooling3 (None, 3, 14, 14, 8)      0         
_________________________________________________________________
dropout_5 (Dropout)          (None, 3, 14, 14, 8)      0         
_________________________________________________________________
flatten_2 (Flatten)          (None, 4704)              0         
_________________________________________________________________
dense_4 (Dense)              (None, 64)                301120    
_________________________________________________________________
dropout_6 (Dropout)          (None, 64)                0         
_________________________________________________________________
dense_5 (Dense)              (None, 32)                2080      
_________________________________________________________________
dropout_7 (Dropout)          (None, 32)                0         
_________________________________________________________________
dense_6 (Dense)              (None, 10)                330       
_________________________________________________________________
activation_2 (Activation)    (None, 10)                0         
=================================================================
Total params: 305,266
Trainable params: 305,266
Non-trainable params: 0
```
_____________
## Initial training results

```
model.fit(X_train, y_train, validation_data=(X, y), batch_size=batch_si,
      epochs=num_epochs, shuffle=True)
Train on 1300 samples, validate on 100 samples
Epoch 1/8
1300/1300 [==============================] - 8s 6ms/step - loss: 4.5109 - mean_squared_error: 0.1800 - acc: 0.2992 - val_loss: 4.5063 - val_mean_squared_error: 0.1800 - val_acc: 0.2300
...
...
Epoch 8/8
1300/1300 [==============================] - 5s 4ms/step - loss: 3.6097 - mean_squared_error: 0.1402 - acc: 0.3252 - val_loss: 3.7023 - val_mean_squared_error: 0.1204 - val_acc: 0.3140
Out[30]: <keras.callbacks.History at 0x7f2ffb6ba390>\
```
____________________________________________________

## Lipnet : Our currently used architecture

```
Layer (type)                     Output Shape          Param #     Connected to                     
====================================================================================================
the_input (InputLayer)           (None, 57, 100, 50, 3 0                                            
____________________________________________________________________________________________________
zero1 (ZeroPadding3D)            (None, 59, 104, 54, 3 0                                            
____________________________________________________________________________________________________
conv1 (Conv3D)                   (None, 57, 50, 25, 32 7232                                         
____________________________________________________________________________________________________
batc1 (BatchNormalization)       (None, 57, 50, 25, 32 128                                          
____________________________________________________________________________________________________
actv1 (Activation)               (None, 57, 50, 25, 32 0                                            
____________________________________________________________________________________________________
spatial_dropout3d_1 (SpatialDrop (None, 57, 50, 25, 32 0                                            
____________________________________________________________________________________________________
max1 (MaxPooling3D)              (None, 57, 25, 12, 32 0                                            
____________________________________________________________________________________________________
zero2 (ZeroPadding3D)            (None, 59, 29, 16, 32 0                                            
____________________________________________________________________________________________________
conv2 (Conv3D)                   (None, 57, 25, 12, 64 153664                                       
____________________________________________________________________________________________________
batc2 (BatchNormalization)       (None, 57, 25, 12, 64 256                                          
____________________________________________________________________________________________________
actv2 (Activation)               (None, 57, 25, 12, 64 0                                            
____________________________________________________________________________________________________
spatial_dropout3d_2 (SpatialDrop (None, 57, 25, 12, 64 0                                            
____________________________________________________________________________________________________
max2 (MaxPooling3D)              (None, 57, 12, 6, 64) 0                                            
____________________________________________________________________________________________________
zero3 (ZeroPadding3D)            (None, 59, 14, 8, 64) 0                                            
____________________________________________________________________________________________________
conv3 (Conv3D)                   (None, 57, 12, 6, 96) 165984                                       
____________________________________________________________________________________________________
batc3 (BatchNormalization)       (None, 57, 12, 6, 96) 384                                          
____________________________________________________________________________________________________
actv3 (Activation)               (None, 57, 12, 6, 96) 0                                            
____________________________________________________________________________________________________
spatial_dropout3d_3 (SpatialDrop (None, 57, 12, 6, 96) 0                                            
____________________________________________________________________________________________________
max3 (MaxPooling3D)              (None, 57, 6, 3, 96)  0                                            
____________________________________________________________________________________________________
time_distributed_1 (TimeDistribu (None, 57, 1728)      0                                            
____________________________________________________________________________________________________
bidirectional_1 (Bidirectional)  (None, 57, 512)       3048960                                      
____________________________________________________________________________________________________
bidirectional_2 (Bidirectional)  (None, 57, 512)       1181184                                      
____________________________________________________________________________________________________
dense1 (Dense)                   (None, 57, 28)        14364                                        
____________________________________________________________________________________________________
softmax (Activation)             (None, 57, 28)        0                                            
____________________________________________________________________________________________________
the_labels (InputLayer)          (None, 32)            0                                            
____________________________________________________________________________________________________
input_length (InputLayer)        (None, 1)             0                                            
____________________________________________________________________________________________________
label_length (InputLayer)        (None, 1)             0                                            
____________________________________________________________________________________________________
ctc (Lambda)                     (None, 1)             0                                            
====================================================================================================
Total params: 4,572,156.0
Trainable params: 4,571,772.0
Non-trainable params: 384.0
____________________________________________________________________________________________________
None
```

## C3D Model we'll be considering

```
model.summary()
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv1 (Conv3D)               (None, 22, 90, 90, 64)    1792      
_________________________________________________________________
pool1 (MaxPooling3D)         (None, 22, 45, 45, 64)    0         
_________________________________________________________________
conv2 (Conv3D)               (None, 22, 45, 45, 128)   221312    
_________________________________________________________________
pool2 (MaxPooling3D)         (None, 11, 22, 22, 128)   0         
_________________________________________________________________
conv3a (Conv3D)              (None, 11, 22, 22, 256)   884992    
_________________________________________________________________
conv3b (Conv3D)              (None, 11, 22, 22, 256)   1769728   
_________________________________________________________________
pool3 (MaxPooling3D)         (None, 5, 11, 11, 256)    0         
_________________________________________________________________
conv4a (Conv3D)              (None, 5, 11, 11, 512)    3539456   
_________________________________________________________________
conv4b (Conv3D)              (None, 5, 11, 11, 512)    7078400   
_________________________________________________________________
pool4 (MaxPooling3D)         (None, 2, 5, 5, 512)      0         
_________________________________________________________________
conv5a (Conv3D)              (None, 2, 5, 5, 512)      7078400   
_________________________________________________________________
conv5b (Conv3D)              (None, 2, 5, 5, 512)      7078400   
_________________________________________________________________
zero_padding3d_1 (ZeroPaddin (None, 2, 7, 7, 512)      0         
_________________________________________________________________
pool5 (MaxPooling3D)         (None, 1, 3, 3, 512)      0         
_________________________________________________________________
flatten_1 (Flatten)          (None, 4608)              0         
_________________________________________________________________
fc6 (Dense)                  (None, 4096)              18878464  
_________________________________________________________________
dropout_1 (Dropout)          (None, 4096)              0         
_________________________________________________________________
fc7 (Dense)                  (None, 4096)              16781312  
_________________________________________________________________
dropout_2 (Dropout)          (None, 4096)              0         
_________________________________________________________________
dense_1 (Dense)              (None, 10)                40970     
_________________________________________________________________
activation_1 (Activation)    (None, 10)                0         
=================================================================
Total params: 63,353,226
Trainable params: 63,353,226
Non-trainable params: 0
_________________________________________________________________
```
